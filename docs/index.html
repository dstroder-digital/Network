<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Edges (PMTiles)</title>
    <!-- MapLibre -->
    <link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>

    <!-- PMTiles: defines global `window.pmtiles` (NO async/defer) -->
    <script src="https://unpkg.com/pmtiles@3.5.0/dist/pmtiles.js"></script>

    <style>
      html, body, #map { height: 100%; margin: 0; }
      body { background: #111; color: #eee; }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <!-- Your app (NO type="module", runs AFTER pmtiles.js) -->
    <script>
      // quick sanity check in the console
      console.log("window.pmtiles is", typeof window.pmtiles);

      // If this logs "undefined", PMTiles didn't load. See notes below.
      if (!window.pmtiles) {
        alert("PMTiles script did not load. Check the Network tab for pmtiles.js");
      }

      // Add PMTiles protocol
      const protocol = new pmtiles.Protocol();
      maplibregl.addProtocol("pmtiles", protocol.tile);

      // Absolute URL to your hosted file on Pages
      const EDGES_PMTILES = "https://dstroder-digital.github.io/Network/docs/data/app/edges.pmtiles";

      const map = new maplibregl.Map({
        container: "map",
        style: {
          version: 8,
          sources: {
            osm: {
              type: "raster",
              tiles: ["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"],
              tileSize: 256,
              attribution: "Â© OpenStreetMap contributors"
            },
            edges: {
              type: "vector",
              url: `pmtiles://${EDGES_PMTILES}`
            }
          },
          layers: [
            { id: "osm", type: "raster", source: "osm" },
            {
              id: "edges",
              type: "line",
              source: "edges",
              "source-layer": "edges",     // must match the tippecanoe --layer name
              paint: { "line-color": "#ff4d4d", "line-width": 2 }
            }
          ]
        },
        center: [-80.84, 35.23],
        zoom: 9
      });

      map.addControl(new maplibregl.NavigationControl(), "top-right");
    </script>
  </body>
</html>
